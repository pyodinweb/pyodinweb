<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics with Consent Mode (Consent Mode v2 defaults set before loading gtag.js) -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);} 
        // Set default consent to 'denied' before GA loads (Consent Mode v2)
        gtag('consent', 'default', {
            'analytics_storage': 'denied',
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'functionality_storage': 'granted',
            'personalization_storage': 'denied',
            'security_storage': 'granted'
        });
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KM0JNZ7JBC"></script>
    <script>
        // Initialize gtag after the library has been loaded
        gtag('js', new Date());
        gtag('config', 'G-KM0JNZ7JBC', {
            'anonymize_ip': true,
            'allow_google_signals': false,
            'allow_ad_personalization_signals': false
        });
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1263613699773711"
         crossorigin="anonymous"></script>
     
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🔥%3C/text%3E%3C/svg%3E">
    <link rel="alternate icon" type="image/png" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🔥%3C/text%3E%3C/svg%3E">
    <link rel="shortcut icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🔥%3C/text%3E%3C/svg%3E">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="PyOdin Web - Advanced browser-based Samsung firmware flashing tool. Free Odin3 and Odin4 alternative using WebUSB technology. Flash Samsung Galaxy firmware directly from your browser without installing desktop software.">
    <meta name="keywords" content="Samsung, Odin3, Odin4, Flashing, Samsung firmware, Odin alternative, WebUSB flasher, Samsung Galaxy flash, browser firmware tool, PyOdin, Samsung Odin web, firmware flashing online, Samsung developer tool, Galaxy firmware update, flash Samsung online, Odin web version">
    <meta name="author" content="PyOdin Development Team">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="PyOdin Web - Samsung Firmware Flasher | Free Odin3/Odin4 Alternative">
    <meta property="og:description" content="Browser-based Samsung firmware flashing tool using WebUSB. Free alternative to Odin3 and Odin4. Flash Samsung Galaxy firmware directly from your browser.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pyodin.web/">
    <meta property="og:site_name" content="PyOdin Web">
    <meta property="og:image" content="https://pyodin.web/og-image.png">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="PyOdin Web - Samsung Firmware Flasher">
    <meta name="twitter:description" content="Free Odin3/Odin4 alternative. Flash Samsung firmware directly in your browser using WebUSB technology.">
    <meta name="twitter:image" content="https://pyodin.web/twitter-card.png">
    
    <title>PyOdin Web - Samsung Firmware Flasher | Free Odin3/Odin4 Alternative</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --dark-color: #343a40;
            --light-color: #f8f9fa;
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
            margin-bottom: 20px;
        }

        .section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e0e0e0;
        }

        .section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .section-title {
            font-size: 1.5em;
            color: var(--dark-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .file-upload {
            border: 2px dashed #ccc;
            border-radius: var(--border-radius);
            padding: 40px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            background: #fafafa;
        }

        .file-upload:hover {
            border-color: var(--primary-color);
            background: #f0f7ff;
        }

        .file-upload.active {
            border-color: var(--primary-color);
            background: #e3f2fd;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
        }

        .device-status {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--danger-color);
            box-shadow: 0 0 10px rgba(220,53,69,0.5);
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: var(--success-color);
            box-shadow: 0 0 10px rgba(40,167,69,0.5);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .device-info {
            flex: 1;
        }

        .device-info h3 {
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .device-info p {
            color: var(--secondary-color);
            font-size: 0.9em;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #667eea);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .progress-info {
            margin-top: 10px;
            color: var(--secondary-color);
            font-size: 0.9em;
        }

        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: var(--border-radius);
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .log-entry.error {
            color: #f48771;
        }

        .log-entry.success {
            color: #89d185;
        }

        .log-entry.warning {
            color: #f5d889;
        }

        .log-entry.info {
            color: #569cd6;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-option label {
            cursor: pointer;
            user-select: none;
        }

        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid var(--warning-color);
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid var(--danger-color);
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            opacity: 0.8;
        }

        .footer a {
            color: white;
            text-decoration: underline;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .firmware-items {
            background: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
        }

        .firmware-item {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .firmware-item:last-child {
            border-bottom: none;
        }

        .firmware-item-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        .firmware-item-size {
            color: var(--secondary-color);
            font-size: 0.9em;
        }

        /* Partition Selection Styles */
        .partition-input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            background: #fafafa;
            transition: var(--transition);
        }

        .partition-input:hover {
            border-color: var(--primary-color);
        }

        .partition-input input[type="file"] {
            cursor: pointer;
        }

        .partition-input input[type="file"]::-webkit-file-upload-button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .partition-input input[type="file"]::-webkit-file-upload-button:hover {
            background: #0056b3;
        }

        .partition-file-name {
            display: block;
            margin-top: 8px;
            font-size: 0.9em;
            color: var(--secondary-color);
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .partition-input {
            min-width: 0;
        }

        .partition-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .partition-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .partition-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Cookie Consent Banner */
        .cookie-consent {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(52, 58, 64, 0.98);
            color: white;
            padding: 20px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            transform: translateY(100%);
            transition: transform 0.4s ease;
            backdrop-filter: blur(10px);
        }

        .cookie-consent.show {
            transform: translateY(0);
        }

        .cookie-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .cookie-text {
            flex: 1;
            min-width: 300px;
        }

        .cookie-text p {
            margin: 0;
            font-size: 14px;
            line-height: 1.6;
        }

        .cookie-text a {
            color: #81c4ff;
            text-decoration: underline;
        }

        .cookie-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .cookie-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .cookie-btn-accept {
            background: #28a745;
            color: white;
        }

        .cookie-btn-accept:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .cookie-btn-decline {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .cookie-btn-decline:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            .cookie-content {
                flex-direction: column;
                align-items: stretch;
            }

            .cookie-buttons {
                width: 100%;
                justify-content: stretch;
            }

            .cookie-btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Cookie Consent Banner -->
    <div class="cookie-consent" id="cookieConsent">
        <div class="cookie-content">
            <div class="cookie-text">
                <p>
                    We use cookies to improve your experience, analyze site usage, and display ads. 
                    By clicking "Accept", you consent to our use of cookies and personalized advertising. 
                    <a href="#" onclick="showPrivacyPolicy(); return false;">Privacy Policy</a>
                </p>
            </div>
            <div class="cookie-buttons">
                <button class="cookie-btn cookie-btn-accept" onclick="acceptCookies()">Accept</button>
                <button class="cookie-btn cookie-btn-decline" onclick="declineCookies()">Decline</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🔥 PyOdin Web</h1>
            <p>Samsung Firmware Flasher - Powered by WebUSB</p>
        </div>

        <div class="main-card">
            <!-- WebUSB Support Check -->
            <div id="webusb-warning" class="alert alert-danger hidden">
                <strong>⚠️ WebUSB Not Supported</strong>
                <p>Your browser doesn't support WebUSB API. Please use Chrome, Edge, or Opera (version 61+).</p>
            </div>

            <!-- Device Connection Section -->
            <div class="section">
                <h2 class="section-title">Device Connection</h2>
                
                <div class="device-status">
                    <div class="status-indicator" id="status-indicator"></div>
                    <div class="device-info">
                        <h3 id="device-status-text">No Device Connected</h3>
                        <p id="device-info-text">Put your Samsung device in Download Mode and click "Connect Device"</p>
                    </div>
                    <button class="btn btn-primary" id="connect-btn" onclick="connectDevice()">
                        Connect Device
                    </button>
                </div>

                <div class="alert alert-info">
                    <strong>ℹ️ How to enter Download Mode:</strong>
                    <p>1. Power off your device completely<br>
                    2. Press and hold Volume Down + Bixby/Home + Power<br>
                    3. When warning appears, press Volume Up to continue</p>
                </div>
            </div>

            <!-- Firmware Selection Section -->
            <div class="section">
                <h2 class="section-title">Firmware Selection</h2>
                
                <div class="partition-grid">
                    <!-- BL -->
                    <div class="partition-input">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color);">
                            BL (Bootloader)
                        </label>
                        <input type="file" id="file-bl" accept=".tar,.tar.md5" onchange="handlePartitionSelect('BL', event)"
                               style="display: block; width: 100%;">
                        <span id="file-bl-name" class="partition-file-name" title="">No file selected</span>
                    </div>

                    <!-- AP -->
                    <div class="partition-input">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color);">
                            AP (System)
                        </label>
                        <input type="file" id="file-ap" accept=".tar,.tar.md5" onchange="handlePartitionSelect('AP', event)"
                               style="display: block; width: 100%;">
                        <span id="file-ap-name" class="partition-file-name" title="">No file selected</span>
                    </div>

                    <!-- CP -->
                    <div class="partition-input">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color);">
                            CP (Modem)
                        </label>
                        <input type="file" id="file-cp" accept=".tar,.tar.md5" onchange="handlePartitionSelect('CP', event)"
                               style="display: block; width: 100%;">
                        <span id="file-cp-name" class="partition-file-name" title="">No file selected</span>
                    </div>

                    <!-- CSC -->
                    <div class="partition-input">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color);">
                            CSC (Region/Carrier)
                        </label>
                        <input type="file" id="file-csc" accept=".tar,.tar.md5" onchange="handlePartitionSelect('CSC', event)"
                               style="display: block; width: 100%;">
                        <span id="file-csc-name" class="partition-file-name" title="">No file selected</span>
                    </div>
                </div>

                <div id="firmware-info" class="hidden">
                    <div class="file-info">
                        <h4>Firmware Information</h4>
                        <p><strong>Files Selected:</strong> <span id="firmware-count">0</span></p>
                        <p><strong>Total Size:</strong> <span id="firmware-size">0 MB</span></p>
                    </div>
                    <div id="firmware-items-container" class="hidden">
                        <h4 style="margin-top: 15px; margin-bottom: 10px;">Firmware Contents:</h4>
                        <div class="firmware-items" id="firmware-items"></div>
                    </div>
                </div>
            </div>

            <!-- Flash Options Section -->
            <div class="section">
                <h2 class="section-title">Flash Options</h2>
                
                <div class="options-grid">
                    <div class="checkbox-option">
                        <input type="checkbox" id="option-verify" checked>
                        <label for="option-verify">Verify Firmware Hash</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="option-reboot" checked>
                        <label for="option-reboot">Auto Reboot After Flash</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="option-verbose" checked>
                        <label for="option-verbose">Verbose Logging</label>
                    </div>
                </div>

                <div class="button-group" style="margin-top: 20px;">
                    <button class="btn btn-success" id="flash-btn" onclick="startFlash()" disabled>
                        Start Flashing
                    </button>
                    <button class="btn btn-danger" id="stop-btn" onclick="stopFlash()" disabled>
                        Stop
                    </button>
                </div>

                <div class="alert alert-warning" style="margin-top: 20px;">
                    <strong>⚠️ Warning:</strong>
                    <p>Flashing firmware can brick your device if done incorrectly. Ensure firmware matches your device model, device is charged >70%, and use a good USB cable.</p>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="section">
                <h2 class="section-title">Progress</h2>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%">0%</div>
                    </div>
                    <div class="progress-info" id="progress-info">
                        Ready to flash
                    </div>
                </div>
            </div>

            <!-- Log Section -->
            <div class="section">
                <h2 class="section-title">Activity Log</h2>
                
                <div class="log-container" id="log-container">
                    <div class="log-entry info">PyOdin Web initialized - Ready to flash</div>
                    <div class="log-entry info">WebUSB API detected - Device connection available</div>
                </div>
            </div>
        </div>

        <!-- Donation Section -->
        <div class="main-card" style="margin-top: 20px; text-align: center; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
            <h2 style="margin-bottom: 15px;">💝 Support This Project</h2>
            <p style="font-size: 1.1em; margin-bottom: 20px;">
                If PyOdin Web has been helpful to you, please consider supporting us with a Bitcoin donation!
            </p>
            <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; margin: 20px auto; max-width: 600px;">
                <p style="font-size: 0.9em; margin-bottom: 10px; opacity: 0.9;">Bitcoin Address:</p>
                <code style="background: rgba(0,0,0,0.3); padding: 12px 20px; border-radius: 5px; font-size: 1.1em; display: inline-block; word-break: break-all; user-select: all;">
                    3CSk7Ci4hFuPu24tdtkw5BE92SwRjaVvBs
                </code>
            </div>
            <p style="font-size: 0.95em; opacity: 0.9;">
                Your donations help keep this project actively maintained. Thank you! 🙏
            </p>
        </div>

        <div class="footer">
            <p>PyOdin Web - Made with ❤️ by the PyOdin Developers</p>
            <p><a href="https://github.com/pyodinweb/pyodinweb" target="_blank">GitHub</a> | 
               <a href="#" onclick="alert('See README for documentation'); return false;">Documentation</a> | 
               <a href="#" onclick="showPrivacyPolicy(); return false;">Privacy Policy</a> | 
               Use at your own risk</p>
        </div>
    </div>

    <!-- External Libraries -->
    <!-- SparkMD5 for fast MD5 hashing -->
    <script src="https://cdn.jsdelivr.net/npm/spark-md5@3.0.2/spark-md5.min.js"></script>
    <!-- pako for GZIP decompression -->
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
    <!-- LZ4 (browserified bundle with wrapper) -->
    <script src="lz4.min.js"></script>
    <script src="lz4-wrapper.js"></script>
    <script src="js/lz4-streaming.js"></script>
    <script src="js/nested-tar-parser.js"></script>
    <script src="js/zip-parser.js"></script>
    
    <!-- Core JavaScript Modules -->
    <script src="js/constants.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/crypto-utils.js"></script>
    <script src="js/usb-device.js"></script>
    <script src="js/firmware-parser.js"></script>
    <script src="js/pit-parser.js"></script>
    <script src="js/download-engine.js"></script>
    <script src="js/flasher.js"></script>
    <script src="js/app.js"></script>

    <!-- Cookie Consent Script -->
    <script>
        // Privacy Policy
        function showPrivacyPolicy() {
            const policy = `PRIVACY POLICY

Last Updated: October 16, 2025

DATA PRIVACY
All user data and files remain in your browser and never leave your device. We do not upload, transmit, or store any of your files or personal data on our servers.

COOKIES AND ADVERTISING
We use cookies for essential functionality, analytics, and displaying personalized advertising through Google AdSense. You can decline non-essential cookies, which will disable ads and analytics.

YOUR RIGHTS (GDPR/CCPA)
You have the right to decline cookies and request information about or deletion of any data collected.

CONTACT
For privacy concerns, visit our GitHub repository.`;
            
            alert(policy);
        }

        // Cookie consent functionality following Google best practices
        
        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + d.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/;SameSite=Strict";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function deleteCookie(name) {
            document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        }

        function acceptCookies() {
            setCookie('cookieConsent', 'accepted', 365);
            
            // Update consent for analytics and ads (AdSense enabled) - IMMEDIATE UPDATE
            gtag('consent', 'update', {
                'analytics_storage': 'granted',
                'ad_storage': 'granted', // Enable ads (required for AdSense)
                'ad_user_data': 'granted', // Enable ad user data
                'ad_personalization': 'granted', // Enable personalized ads
                'personalization_storage': 'granted'
            });
            
            // Trigger a page_view event to immediately activate analytics
            gtag('event', 'page_view', {
                'send_to': 'G-KM0JNZ7JBC'
            });
            
            // Request ads refresh if AdSense is loaded
            if (window.adsbygoogle && window.adsbygoogle.loaded) {
                console.log('AdSense ready - Ads will display on next ad slot');
            }
            
            hideCookieBanner();
            console.log('✅ Cookies accepted - Analytics and ads enabled immediately (no refresh needed)');
        }

        function declineCookies() {
            // Don't save any cookie on decline - user will be asked again on next visit
            // This ensures we ask for consent on every page load until user accepts
            
            // Ensure consent remains denied (no ads, no analytics) - IMMEDIATE UPDATE
            gtag('consent', 'update', {
                'analytics_storage': 'denied',
                'ad_storage': 'denied',
                'ad_user_data': 'denied',
                'ad_personalization': 'denied',
                'personalization_storage': 'denied'
            });
            
            // Clear any existing analytics cookies immediately
            clearAnalyticsCookies();
            
            // Also clear any existing consent cookie
            deleteCookie('cookieConsent');
            
            hideCookieBanner();
            console.log('❌ Cookies declined - You will be asked again on next visit');
        }

        function clearAnalyticsCookies() {
            // Clear Google Analytics cookies if they exist
            const gaCookies = ['_ga', '_gat', '_gid', '_gat_gtag'];
            gaCookies.forEach(cookie => {
                deleteCookie(cookie);
                // Also try to delete with domain prefix
                document.cookie = cookie + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=" + window.location.hostname;
            });
        }

        function loadAnalytics() {
            // GA is already loaded in head, just update consent dynamically
            const consent = getCookie('cookieConsent');
            if (consent === 'accepted') {
                gtag('consent', 'update', {
                    'analytics_storage': 'granted',
                    'ad_storage': 'granted',
                    'ad_user_data': 'granted',
                    'ad_personalization': 'granted',
                    'personalization_storage': 'granted'
                });
                // Send page_view event to activate tracking immediately
                gtag('event', 'page_view', {
                    'send_to': 'G-KM0JNZ7JBC'
                });
                console.log('✅ Google Analytics and AdSense enabled (from previous consent)');
            }
        }

        function hideCookieBanner() {
            const banner = document.getElementById('cookieConsent');
            banner.classList.remove('show');
        }

        function showCookieBanner() {
            const banner = document.getElementById('cookieConsent');
            setTimeout(() => {
                banner.classList.add('show');
            }, 500); // Small delay before showing
        }

        // Check if user has already made a choice - Initialize consent state dynamically
        window.addEventListener('DOMContentLoaded', () => {
            const consent = getCookie('cookieConsent');
            
            if (!consent) {
                // No saved consent - show banner (first visit or user declined previously)
                showCookieBanner();
                console.log('ℹ️ Cookie consent banner displayed - Waiting for user decision');
            } else if (consent === 'accepted') {
                // User previously accepted - update consent dynamically and load analytics immediately
                gtag('consent', 'update', {
                    'analytics_storage': 'granted',
                    'ad_storage': 'granted',
                    'ad_user_data': 'granted',
                    'ad_personalization': 'granted',
                    'personalization_storage': 'granted'
                });
                loadAnalytics();
                console.log('✅ Returning user - Consent already accepted, analytics active');
            }
        });
    </script>
</body>
</html>

